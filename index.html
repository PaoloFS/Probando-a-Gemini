<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA v6.0 | Cognitive Core</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8b5cf6;
            --secondary: #3b82f6;
            --bg: #0f172a;
            --glass: rgba(30, 41, 59, 0.7);
            --text: #f8fafc;
        }

        body {
            margin: 0;
            font-family: 'Outfit', sans-serif;
            background: radial-gradient(circle at top right, #1e1b4b, var(--bg));
            color: var(--text);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #aura-container {
            width: 95%;
            max-width: 1000px;
            height: 85vh;
            background: var(--glass);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        header {
            padding: 20px 30px;
            background: rgba(15, 23, 42, 0.6);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .ai-pulse {
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
            box-shadow: 0 0 15px #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        #chat-flow {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        .bubble {
            max-width: 80%;
            padding: 18px 24px;
            border-radius: 20px;
            font-size: 16px;
            line-height: 1.6;
            animation: slideUp 0.3s ease-out;
            position: relative;
        }

        .user-bubble {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-bottom-right-radius: 4px;
        }

        .ai-bubble {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-bottom-left-radius: 4px;
        }

        .speak-btn {
            position: absolute;
            bottom: -25px;
            left: 10px;
            background: transparent;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: color 0.2s;
        }

        .speak-btn:hover { color: var(--secondary); }

        .typing {
            align-self: flex-start;
            color: #94a3b8;
            font-size: 14px;
            font-style: italic;
            display: none;
        }

        .input-wrapper {
            padding: 25px 30px;
            background: rgba(15, 23, 42, 0.8);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        input {
            flex: 1;
            padding: 16px 25px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.03);
            color: white;
            outline: none;
            font-size: 16px;
            font-family: inherit;
            transition: 0.3s;
        }

        input:focus { border-color: var(--primary); background: rgba(255,255,255,0.08); }

        button.send-btn {
            padding: 16px 30px;
            background: white;
            color: var(--bg);
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: 0.3s;
        }

        button.send-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255,255,255,0.2); }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
    </style>
</head>
<body>

<div id="aura-container">
    <header>
        <div style="font-size: 20px; font-weight: 600; letter-spacing: 1px;">AURA <span style="color: var(--primary); font-weight: 300;">v6.0</span></div>
        <div style="font-size: 13px; color: #cbd5e1;"><span class="ai-pulse"></span> Motor Cognitivo Conectado</div>
    </header>

    <div id="chat-flow">
        <div class="bubble ai-bubble">
            Sistemas actualizados a la red neuronal global. Tengo memoria de contexto, hablo múltiples idiomas y conozco tu entorno. Ponme a prueba.
        </div>
        <div class="typing" id="typing-indicator">AURA está procesando...</div>
    </div>

    <form class="input-wrapper" id="chat-form">
        <input type="text" id="userInput" placeholder="Habla conmigo libremente..." autofocus autocomplete="off">
        <button type="submit" class="send-btn">Enviar</button>
    </form>
</div>

<script>
    const flow = document.getElementById('chat-flow');
    const form = document.getElementById('chat-form');
    const input = document.getElementById('userInput');
    const typing = document.getElementById('typing-indicator');

    // Inicializamos la memoria de la IA
    let chatHistory = [];
    const synth = window.speechSynthesis;

    // Construcción del "Alma" de la IA
    function getSystemPrompt() {
        const now = new Date();
        const time = now.toLocaleTimeString('es-PE', { hour: '2-digit', minute: '2-digit' });
        const date = now.toLocaleDateString('es-PE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        
        return `Eres AURA, un asistente de Inteligencia Artificial avanzado. 
        Contexto del usuario: Su nombre es Paolo, se encuentra en Ica, Perú.
        Contexto temporal: Hoy es ${date} y la hora actual es ${time}.
        Reglas: 
        1. Si te piden la hora o fecha, da los datos reales del contexto temporal.
        2. Responde en el mismo idioma en el que te hable el usuario (si habla inglés, responde en inglés natural).
        3. Tienes memoria. Si el usuario hace una referencia a un mensaje anterior, síguele el hilo.
        4. Sé amable, inteligente y directo.`;
    }

    async function processAura(userText) {
        addBubble(userText, 'user-bubble');
        
        // Mostrar "escribiendo..."
        typing.style.display = 'block';
        flow.appendChild(typing);
        flow.scrollTop = flow.scrollHeight;

        // Añadir a la memoria
        chatHistory.push({ role: 'user', content: userText });
        
        // Preparar el paquete de datos para el LLM
        const messages = [
            { role: 'system', content: getSystemPrompt() },
            ...chatHistory.slice(-6) // Enviamos solo los últimos 6 mensajes para no saturar
        ];

        try {
            // Usamos una API de LLM real (Pollinations) que no requiere API Key
            const response = await fetch('https://text.pollinations.ai/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ messages: messages })
            });

            if (!response.ok) throw new Error('Network response was not ok');
            
            const aiText = await response.text();
            
            // Ocultar escribiendo y guardar en memoria
            typing.style.display = 'none';
            chatHistory.push({ role: 'assistant', content: aiText });
            
            addBubble(aiText, 'ai-bubble', true);

        } catch (error) {
            typing.style.display = 'none';
            addBubble("Lo siento Paolo, hay interferencia en la red neuronal en este momento.", 'ai-bubble');
        }
    }

    function addBubble(text, className, addVoice = false) {
        const div = document.createElement('div');
        div.className = `bubble ${className}`;
        
        // Limpiamos un poco el formato markdown básico que envían los LLM
        let cleanText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        div.innerHTML = cleanText;

        if (addVoice) {
            const btn = document.createElement('button');
            btn.className = 'speak-btn';
            btn.innerHTML = '▶ Escuchar';
            btn.onclick = () => speak(text);
            div.appendChild(btn);
        }

        flow.insertBefore(div, typing);
        flow.scrollTop = flow.scrollHeight;
    }

    function speak(text) {
        synth.cancel(); // Detener si hay otra voz sonando
        const utterance = new SpeechSynthesisUtterance(text);
        
        // Detectar idioma para la voz
        const isEnglish = /^[a-zA-Z\s.,?!]+$/.test(text.substring(0, 20)); 
        utterance.lang = isEnglish ? 'en-US' : 'es-PE';
        
        // Buscar una voz femenina agradable si está disponible
        const voices = synth.getVoices();
        const preferredVoice = voices.find(v => v.lang.includes('es') && v.name.includes('Google'));
        if (preferredVoice) utterance.voice = preferredVoice;
        
        synth.speak(utterance);
    }

    form.onsubmit = (e) => {
        e.preventDefault();
        if (input.value.trim()) {
            processAura(input.value);
            input.value = '';
        }
    };
</script>
</body>
</html>
